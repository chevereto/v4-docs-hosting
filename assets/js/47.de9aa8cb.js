(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{374:function(e,t,r){"use strict";r.r(t);var a=r(25),n=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"encryption"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#encryption"}},[e._v("#")]),e._v(" Encryption")]),e._v(" "),t("p",[e._v("Chevereto uses "),t("a",{attrs:{href:"https://datatracker.ietf.org/doc/html/rfc7539",target:"_blank",rel:"noopener noreferrer"}},[e._v("ChaCha20"),t("OutboundLink")],1),e._v(" algorithm to cipher secrets and sensitive data. When enabled, Chevereto will store these values encrypted in the database.")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("Requires manual update")]),e._v(" "),t("p",[e._v("Encryption in Chevereto was added in "),t("code",[e._v("v4.0.0-beta.10")]),e._v(". If you installed Chevereto prior to this release you will require to "),t("a",{attrs:{href:"#enabling-encryption"}},[e._v("manually enable encryption")]),e._v(".")])]),e._v(" "),t("h2",{attrs:{id:"what-is-encrypted"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#what-is-encrypted"}},[e._v("#")]),e._v(" What is encrypted?")]),e._v(" "),t("h3",{attrs:{id:"settings-secrets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#settings-secrets"}},[e._v("#")]),e._v(" Settings secrets")]),e._v(" "),t("p",[e._v("The following settings are encrypted in the database:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Setting")]),e._v(" "),t("th",[e._v("Key")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[t("RouterLink",{attrs:{to:"/developer/api/api-v1.html#key"}},[e._v("API V1 key (public)")])],1),e._v(" "),t("td",[e._v("api_v1_key")])]),e._v(" "),t("tr",[t("td",[e._v("Album password")]),e._v(" "),t("td",[e._v("album_password")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/email.html#smtp-server-and-port",target:"_blank",rel:"noopener noreferrer"}},[e._v("SMTP server"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("email_smtp_server")])]),e._v(" "),t("tr",[t("td",[e._v("SMTP port")]),e._v(" "),t("td",[e._v("email_smtp_server_port")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/email.html#smtp-username",target:"_blank",rel:"noopener noreferrer"}},[e._v("SMTP username"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("email_smtp_server_username")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/email.html#smtp-password",target:"_blank",rel:"noopener noreferrer"}},[e._v("SMTP password"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("email_smtp_server_password")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/external-services.html#recaptcha-secret-key",target:"_blank",rel:"noopener noreferrer"}},[e._v("reCAPTCHA secret key"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("recaptcha_private_key")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/external-services.html#disqus-secret-key",target:"_blank",rel:"noopener noreferrer"}},[e._v("Disqus secret key"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("disqus_secret_key")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/external-services.html#akismet-api-key",target:"_blank",rel:"noopener noreferrer"}},[e._v("Akismet API key"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("akismet_api_key")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/external-services.html#moderatecontent-api-key",target:"_blank",rel:"noopener noreferrer"}},[e._v("ModerateContent API Key"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("moderatecontent_key")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/external-services.html#project-arachnid-api-key",target:"_blank",rel:"noopener noreferrer"}},[e._v("Project Arachnid API Username"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("arachnid_api_username")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/external-services.html#project-arachnid-api-key",target:"_blank",rel:"noopener noreferrer"}},[e._v("Project Arachnid API Password"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("arachnid_api_password")])])])]),e._v(" "),t("h3",{attrs:{id:"storage-credentials"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#storage-credentials"}},[e._v("#")]),e._v(" Storage credentials")]),e._v(" "),t("p",[e._v("The following storage columns for "),t("code",[e._v("chv_storages")]),e._v(" are encrypted in the database:")]),e._v(" "),t("ul",[t("li",[e._v("server")]),e._v(" "),t("li",[e._v("service")]),e._v(" "),t("li",[e._v("account_id")]),e._v(" "),t("li",[e._v("account_name")]),e._v(" "),t("li",[e._v("key")]),e._v(" "),t("li",[e._v("secret")]),e._v(" "),t("li",[e._v("bucket")])]),e._v(" "),t("h3",{attrs:{id:"two-factor-secrets"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#two-factor-secrets"}},[e._v("#")]),e._v(" Two-factor secrets")]),e._v(" "),t("p",[e._v("Two-factor secret codes used to generate TOTP are encrypted in the database. Table "),t("code",[e._v("chv_two_factors")]),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#key"}},[e._v("#")]),e._v(" Key")]),e._v(" "),t("p",[e._v("The encryption key is base64 encoded random string of size 32. To generate a key use "),t("code",[e._v("openssl")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("openssl rand "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-base64")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("32")]),e._v("\n")])])]),t("h3",{attrs:{id:"key-security"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#key-security"}},[e._v("#")]),e._v(" Key security")]),e._v(" "),t("p",[e._v("Handle the encryption key with the same discretion of a password.")]),e._v(" "),t("ul",[t("li",[e._v("The encryption key should remain "),t("strong",[e._v("private")]),e._v(".")]),e._v(" "),t("li",[e._v("Don't re-use the same key in different installations.")]),e._v(" "),t("li",[e._v("Backup the key in a safe location.")])]),e._v(" "),t("h2",{attrs:{id:"enabling-encryption"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#enabling-encryption"}},[e._v("#")]),e._v(" Enabling encryption")]),e._v(" "),t("p",[e._v("To enable encryption provide the "),t("RouterLink",{attrs:{to:"/application/configuration/environment.html#encryption-key"}},[e._v("CHEVERETO_ENCRYPTION_KEY")]),e._v(" environment variable.")],1),e._v(" "),t("p",[e._v("This key is automatic provided on "),t("RouterLink",{attrs:{to:"/application/installing/installation.html#setup"}},[e._v("setup")]),e._v(", stored in the "),t("RouterLink",{attrs:{to:"/application/configuration/configuring.html#using-appenvphp"}},[e._v("app/env.php")]),e._v(" file.")],1),e._v(" "),t("h3",{attrs:{id:"from-previous-versions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#from-previous-versions"}},[e._v("#")]),e._v(" From previous versions")]),e._v(" "),t("p",[e._v("Chevereto installations previous the introduction of encryption will require to manually cipher the existing data. This is a one time process that encrypts the plain text data stored in the database.")]),e._v(" "),t("p",[e._v("To manually enable encryption:")]),e._v(" "),t("ul",[t("li",[e._v("Enable "),t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/system.html#maintenance",target:"_blank",rel:"noopener noreferrer"}},[e._v("maintenance"),t("OutboundLink")],1),e._v(" mode.")]),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/application/configuration/configuring.html"}},[e._v("Configure")]),e._v(" the "),t("code",[e._v("CHEVERETO_ENCRYPTION_KEY")]),e._v(" variable.")],1),e._v(" "),t("li",[e._v("Run "),t("RouterLink",{attrs:{to:"/application/reference/cli.html#encrypt-secrets"}},[e._v("encrypt-secrets")]),e._v(" command.")],1),e._v(" "),t("li",[e._v("Disable maintenance mode.")])]),e._v(" "),t("h2",{attrs:{id:"disabling-encryption"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#disabling-encryption"}},[e._v("#")]),e._v(" Disabling encryption")]),e._v(" "),t("p",[e._v("When disabling encryption all the cipher texts stored in the database will be reverted to its plain text value.")]),e._v(" "),t("p",[e._v("To disable encryption:")]),e._v(" "),t("ul",[t("li",[e._v("Enable "),t("a",{attrs:{href:"https://v4-admin.chevereto.com/settings/system.html#maintenance",target:"_blank",rel:"noopener noreferrer"}},[e._v("maintenance"),t("OutboundLink")],1),e._v(" mode.")]),e._v(" "),t("li",[e._v("Run "),t("RouterLink",{attrs:{to:"/application/reference/cli.html#decrypt-secrets"}},[e._v("decrypt-secrets")]),e._v(" command.")],1),e._v(" "),t("li",[t("RouterLink",{attrs:{to:"/application/configuration/configuring.html"}},[e._v("Configure")]),e._v(" the "),t("code",[e._v("CHEVERETO_ENCRYPTION_KEY")]),e._v(" variable to empty string.")],1),e._v(" "),t("li",[e._v("Disable maintenance mode.")])])])}),[],!1,null,null,null);t.default=n.exports}}]);